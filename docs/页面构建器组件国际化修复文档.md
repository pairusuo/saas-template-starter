问题概述

  在页面构建器中，多个组件存在硬编码文本和国际化配置问题，导致组件无法正确显示多语
  言内容。主要问题包括：

  1. 组件中硬编码中文/英文文本
  2. 没有使用 useTranslations 钩子
  3. 翻译文件结构不一致或缺失
  4. i18n 配置中缺少对应的 namespace
  5. 组件配置中存在硬编码默认值

  已修复的组件

  - HeaderBasic (src/components/page-builder/components/headers/HeaderBasic.tsx)
  - FooterBasic (src/components/page-builder/components/footers/FooterBasic.tsx)
  - HeroSimple (src/components/page-builder/components/heroes/HeroSimple.tsx)

  问题分析与解决方案

  1. 组件代码问题

  问题表现：

  // ❌ 硬编码中文文本
  export function HeaderBasic({ 
    logo = 'SaaS Template',
    navigation = [
      { label: '功能', href: '#features' },
      { label: '定价', href: '#pricing' },
      // ...
    ],
    ctaText = '立即开始'
  }: HeaderBasicProps) {
    return (
      <header>
        <span>{logo}</span>
        {navigation.map(item => <a href={item.href}>{item.label}</a>)}
        <button>{ctaText}</button>
      </header>
    );
  }

  解决方案：

  // ✅ 使用国际化
  import { useTranslations } from 'next-intl';

  export function HeaderBasic({ 
    logo,
    navigation,
    ctaText
  }: HeaderBasicProps) {
    const t = useTranslations('header-basic');

    // 从翻译文件获取嵌套数据
    const headerData = t.raw('header-basic') as any;

    // 使用传入props或翻译数据，提供英文默认值
    const finalLogo = logo || headerData?.logo || 'SaaS Template';
    const navigationFromI18n = headerData?.navigation || [];
    const finalNavigation = navigation || (Array.isArray(navigationFromI18n) ?
  navigationFromI18n : []);
    const finalCtaText = ctaText || headerData?.ctaText || 'Get Started';

    return (
      <header>
        <span>{finalLogo}</span>
        {finalNavigation.map(item => <a href={item.href}>{item.label}</a>)}
        <button>{finalCtaText}</button>
      </header>
    );
  }

  2. 翻译文件问题

  问题表现：

  - 翻译文件不存在
  - 翻译文件结构不一致
  - 翻译键名与组件不匹配

  解决方案：

  创建规范的嵌套翻译文件结构：

  messages/en/header-basic.json：
  {
    "header-basic": {
      "logo": "SaaS Template",
      "navigation": [
        { "label": "Features", "href": "#features" },
        { "label": "Pricing", "href": "#pricing" },
        { "label": "About", "href": "#about" },
        { "label": "Contact", "href": "#contact" }
      ],
      "showCTA": true,
      "ctaText": "Start Now"
    }
  }

  messages/zh/header-basic.json：
  {
    "header-basic": {
      "logo": "SaaS 模板",
      "navigation": [
        { "label": "功能", "href": "#features" },
        { "label": "定价", "href": "#pricing" },
        { "label": "关于我们", "href": "#about" },
        { "label": "联系我们", "href": "#contact" }
      ],
      "showCTA": true,
      "ctaText": "立即开始"
    }
  }

  3. i18n 配置问题

  问题表现：

  // ❌ 缺少新组件的 namespace
  const namespaces = [
    'navigation', 'topbar', 'header-basic', 'footer', 'errors', 'hero'
    // 缺少 'footer-basic', 'hero-simple' 等
  ];

  错误信息：
  IntlError: MISSING_MESSAGE: Could not resolve `footer-basic` in messages for 
  locale `en`.

  解决方案：

  在 src/i18n.ts 中添加对应的 namespace：

  // ✅ 添加所有必要的 namespaces
  const namespaces = [
    'navigation', 'topbar', 'header-basic', 'footer-basic', 'footer', 'errors',
    'hero', 'hero-simple', 'features', 'stats'
    // 确保包含所有组件的翻译 namespace
  ];

  4. 组件配置问题

  问题表现：

  // ❌ 组件配置中的硬编码默认值会覆盖国际化
  defaultProps: {
    logo: 'SaaS Template',
    navigation: [
      { label: '功能', href: '#features' }, // 硬编码中文
      { label: '定价', href: '#pricing' }
    ],
    ctaText: '立即开始'
  }

  解决方案：

  // ✅ 移除硬编码，让组件使用国际化
  defaultProps: {
    // 移除硬编码的默认值，让组件使用国际化翻译
  }

  标准修复流程

  Step 1: 分析组件

  1. 检查组件是否使用 useTranslations
  2. 识别所有硬编码文本
  3. 确认组件的翻译需求

  Step 2: 创建翻译文件

  1. 创建 messages/en/[component-name].json
  2. 创建 messages/zh/[component-name].json
  3. 使用嵌套结构：{ "component-name": { ... } }

  Step 3: 修复组件代码

  1. 导入 useTranslations
  2. 添加 const t = useTranslations('component-name')
  3. 使用 t.raw('component-name') 获取翻译数据
  4. 将硬编码默认值替换为翻译值 + 英文默认值
  5. 添加数组安全检查

  Step 4: 更新配置

  1. 在 src/i18n.ts 的 namespaces 数组中添加组件名
  2. 在组件配置的 defaultProps 中移除硬编码值

  Step 5: 重启服务

  - 重启开发服务器（i18n 配置变化需要重启）

  代码模板

  组件国际化模板

  'use client';

  import { useTranslations } from 'next-intl';
  import { ComponentProps } from './types';

  export function ComponentName({ 
    prop1,
    prop2,
    className 
  }: ComponentProps) {
    const t = useTranslations('component-name');

    // 从翻译文件获取嵌套数据
    const componentData = t.raw('component-name') as any;

    // 使用props或翻译数据，提供英文默认值
    const finalProp1 = prop1 || componentData?.prop1 || 'English Default';
    const finalProp2 = prop2 || componentData?.prop2 || 'Another Default';

    return (
      <div className={className}>
        <h1>{finalProp1}</h1>
        <p>{finalProp2}</p>
      </div>
    );
  }

  翻译文件模板

  {
    "component-name": {
      "prop1": "Translation Value",
      "prop2": "Another Translation",
      "arrayProp": [
        { "label": "Item 1", "href": "#item1" },
        { "label": "Item 2", "href": "#item2" }
      ]
    }
  }

  常见错误及解决方案

  Error 1: finalNavigation.map is not a function

  原因：翻译数据不是数组
  解决：添加数组检查
  const finalNavigation = navigation || (Array.isArray(navigationFromI18n) ?
  navigationFromI18n : []);

  Error 2: MISSING_MESSAGE: Could not resolve 'component-name'

  原因：i18n 配置中缺少 namespace
  解决：在 src/i18n.ts 中添加对应 namespace

  Error 3: 显示 component-name.property 而非实际值

  原因：翻译文件结构不正确或访问方式错误
  解决：确保使用 t.raw('component-name') 并检查翻译文件结构

  测试检查清单

  - 英文环境 (/en/page-builder) 显示英文内容
  - 中文环境 (/zh/page-builder) 显示中文内容
  - 组件拖拽后无错误信息
  - 数组属性（如导航链接）正确显示
  - 布尔属性（如按钮显示）正确工作
  - 提供的 props 能覆盖默认翻译
  - 缺少翻译时显示英文默认值

## ⚠️ 重要：页面构建器配置文件修复

除了组件本身的国际化修复，还需要检查和修复页面构建器的配置文件，这些配置文件中的硬编码默认值会覆盖组件的国际化设置：

### 5. 页面构建器配置问题

**问题表现：**

页面构建器的配置文件中存在硬编码的 `defaultProps`，会覆盖组件的国际化翻译：

```typescript
// ❌ src/utils/page-builder/component-configs.ts 中的硬编码默认值
{
  type: 'hero-centered',
  defaultProps: {
    badge: '新功能：增强的UI组件',      // 硬编码中文
    title: '几天内构建现代化 SaaS 应用', // 硬编码中文  
    subtitle: '基于 Next.js 14 的完整 SaaS 模板...',
    primaryButtonText: '立即开始',    // 硬编码中文
    secondaryButtonText: '查看演示',   // 硬编码中文
  },
}

// ❌ src/components/page-builder/components/registry.ts 中错误的 i18n 命名空间
{
  id: 'hero-centered',
  i18nNamespace: 'hero',  // 应该是 'hero-centered'
}
```

**解决方案：**

1. **清空配置文件中的硬编码默认值**：

```typescript
// ✅ src/utils/page-builder/component-configs.ts
{
  type: 'hero-centered',
  defaultProps: {
    // 移除硬编码的默认值，让组件使用国际化翻译
  },
}
```

2. **修复注册表中的 i18n 命名空间**：

```typescript
// ✅ src/components/page-builder/components/registry.ts
{
  id: 'hero-centered',
  i18nNamespace: 'hero-centered',  // 使用正确的命名空间
}
```

### 配置文件修复检查清单

在修复组件国际化时，**必须同时检查**以下配置文件：

- [ ] `src/utils/page-builder/component-configs.ts` - 清空 `defaultProps` 中的硬编码值
- [ ] `src/components/page-builder/components/registry.ts` - 确认 `i18nNamespace` 正确
- [ ] `src/i18n.ts` - 添加对应的 namespace
- [ ] 重启开发服务器（配置变化需要重启）

### 修复流程更新

**Step 5: 检查页面构建器配置文件**

1. 在 `src/utils/page-builder/component-configs.ts` 中找到对应组件配置
2. 清空 `defaultProps` 中的硬编码值
3. 在 `src/components/page-builder/components/registry.ts` 中确认 `i18nNamespace` 正确
4. 重启开发服务器

### 常见错误补充

**Error 4: 组件已修复但页面构建器仍显示硬编码内容**

原因：页面构建器配置文件中的 `defaultProps` 覆盖了组件的国际化设置
解决：检查并清空 `component-configs.ts` 和 `registry.ts` 中的硬编码值

**Error 5: 翻译文件正确但组件找不到翻译**

原因：`registry.ts` 中的 `i18nNamespace` 与翻译文件名不匹配
解决：确保 `i18nNamespace: 'component-name'` 与翻译文件 `messages/xx/component-name.json` 一致

  需要修复的其他组件

  基于相同模式，以下组件可能需要类似修复：
  - ~~HeroCentered~~ ✅ 已修复
  - FeaturesGrid
  - PricingCards
  - TestimonialsGrid
  - 其他页面构建器组件

  建议按照上述流程逐个检查和修复。